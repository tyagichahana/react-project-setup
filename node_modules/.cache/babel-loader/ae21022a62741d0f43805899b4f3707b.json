{"ast":null,"code":"import history from '@/utils/history';\nimport * as types from '@/constants/Types';\nimport OktaSignIn from '@okta/okta-signin-widget';\nimport '@okta/okta-signin-widget/dist/css/okta-sign-in.min.css';\nimport '@okta/okta-signin-widget/dist/css/okta-theme.css';\nimport Api from '@/utils/Api';\nimport Store from '@/reducer';\nexport var AUTH_TOKEN_KEY = 'AUTH_TOKEN_KEY';\nexport function loginAction(data) {\n  Api.loginUser(data).then(function (res) {\n    if (res.success) {\n      Store.dispatch({\n        type: types.LOGIN_SUCCESS,\n        data: res\n      });\n      localStorage.setItem(AUTH_TOKEN_KEY, '324234324234');\n      redirectLogin();\n    } else {\n      Store.dispatch({\n        type: types.LOGIN_FAILURE,\n        data: res.error\n      });\n      clearSession();\n    }\n  }).catch(function (err) {\n    Store.dispatch({\n      type: types.LOGIN_FAILURE,\n      data: err.message\n    });\n    clearSession();\n  });\n}\n\nfunction clearSession() {\n  window.widget.session.close(function (err) {\n    window.widget.remove();\n    localStorage.removeItem(AUTH_TOKEN_KEY);\n  });\n  history.push('/login-status');\n}\n\nexport function redirectLogin() {\n  var localToken = window.localStorage.getItem(AUTH_TOKEN_KEY);\n  var pathname = window.location.pathname;\n\n  if (localToken) {\n    if (pathname === '/' || pathname === '/login') {\n      history.push('/campaign');\n    }\n  } else {\n    var _pathname = window.location.pathname;\n\n    if (_pathname === '/login') {\n      return;\n    } else if (_pathname === '/') {\n      window.location.href = '/login';\n    } else {}\n  }\n}\nexport function singin() {\n  var widget = new OktaSignIn({\n    baseUrl: 'https://dev-943044.okta.com',\n    logo: 'https://ecs7.tokopedia.net/img/footer/toped.png',\n    clientId: '0oahjwuaxD819c7AM356',\n    redirectUri: window.location.origin + '/implicit/callback',\n    authParams: {\n      responseType: ['id_token', 'token']\n    }\n  });\n  Store.dispatch({\n    type: types.OKTA_LOADING\n  });\n\n  var logOutUser = function logOutUser() {\n    localStorage.removeItem(AUTH_TOKEN_KEY);\n    history.push('/login');\n  };\n\n  widget.session.get(function (response) {\n    if (response.status === 'ACTIVE') {\n      loginAction({\n        email: response.login,\n        oktaToken: response.id\n      });\n      Store.dispatch({\n        type: types.OKTA_LOADING_DONE\n      });\n    } else if (response.status === 'INACTIVE') {\n      Store.dispatch({\n        type: types.OKTA_LOADING_DONE\n      });\n      logOutUser();\n    }\n  });\n  return widget;\n}","map":{"version":3,"sources":["/Users/chahanatyagi/Work/cm-frontend/src/actions/User.js"],"names":["history","types","OktaSignIn","Api","Store","AUTH_TOKEN_KEY","loginAction","data","loginUser","then","res","success","dispatch","type","LOGIN_SUCCESS","localStorage","setItem","redirectLogin","LOGIN_FAILURE","error","clearSession","catch","err","message","window","widget","session","close","remove","removeItem","push","localToken","getItem","pathname","location","href","singin","baseUrl","logo","clientId","redirectUri","origin","authParams","responseType","OKTA_LOADING","logOutUser","get","response","status","email","login","oktaToken","id","OKTA_LOADING_DONE"],"mappings":"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","sourcesContent":["import history from '@/utils/history'\nimport * as types from '@/constants/Types'\nimport OktaSignIn from '@okta/okta-signin-widget'\nimport '@okta/okta-signin-widget/dist/css/okta-sign-in.min.css'\nimport '@okta/okta-signin-widget/dist/css/okta-theme.css'\nimport Api from '@/utils/Api'\nimport Store from '@/reducer'\nexport const AUTH_TOKEN_KEY = 'AUTH_TOKEN_KEY'\n\nexport function loginAction(data) {\n    Api.loginUser(data)\n        .then(res => {\n            if (res.success) {\n                Store.dispatch({\n                    type: types.LOGIN_SUCCESS,\n                    data: res,\n                })\n                localStorage.setItem(AUTH_TOKEN_KEY, '324234324234')\n                redirectLogin()\n            } else {\n                Store.dispatch({\n                    type: types.LOGIN_FAILURE,\n                    data: res.error,\n                })\n                clearSession()\n            }\n        })\n        .catch(err => {\n            Store.dispatch({\n                type: types.LOGIN_FAILURE,\n                data: err.message,\n            })\n            clearSession()\n        })\n}\nfunction clearSession() {\n    window.widget.session.close(function(err) {\n        window.widget.remove()\n        localStorage.removeItem(AUTH_TOKEN_KEY)\n    })\n    history.push('/login-status')\n}\n\nexport function redirectLogin() {\n    const localToken = window.localStorage.getItem(AUTH_TOKEN_KEY)\n    const { pathname } = window.location\n    if (localToken) {\n        if (pathname === '/' || pathname === '/login') {\n            history.push('/campaign')\n        }\n    } else {\n        const { pathname } = window.location\n        if (pathname === '/login') {\n            return\n        } else if (pathname === '/') {\n            window.location.href = '/login'\n        } else {\n        }\n    }\n}\n\nexport function singin() {\n    var widget = new OktaSignIn({\n        baseUrl: 'https://dev-943044.okta.com',\n        logo: 'https://ecs7.tokopedia.net/img/footer/toped.png',\n        clientId: '0oahjwuaxD819c7AM356',\n        redirectUri: window.location.origin + '/implicit/callback',\n        authParams: {\n            responseType: ['id_token', 'token'],\n        },\n    })\n    Store.dispatch({\n        type: types.OKTA_LOADING,\n    })\n    var logOutUser = () => {\n        localStorage.removeItem(AUTH_TOKEN_KEY)\n        history.push('/login')\n    }\n\n    widget.session.get(response => {\n        if (response.status === 'ACTIVE') {\n            loginAction({ email: response.login, oktaToken: response.id })\n            Store.dispatch({\n                type: types.OKTA_LOADING_DONE,\n            })\n        } else if (response.status === 'INACTIVE') {\n            Store.dispatch({\n                type: types.OKTA_LOADING_DONE,\n            })\n            logOutUser()\n        }\n    })\n    return widget\n}\n"]},"metadata":{},"sourceType":"module"}