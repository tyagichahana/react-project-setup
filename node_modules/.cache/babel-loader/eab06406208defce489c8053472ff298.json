{"ast":null,"code":"import history from '@/utils/history';\nimport * as types from '@/constants/Types'; // import OktaSignIn from '@okta/okta-signin-widget'\n\nimport '@okta/okta-signin-widget/dist/css/okta-sign-in.min.css';\nimport '@okta/okta-signin-widget/dist/css/okta-theme.css';\nimport Api from '@/utils/Api';\nimport Store from '@/reducer';\nexport var AUTH_TOKEN_KEY = 'AUTH_TOKEN_KEY';\nexport function loginAction(data) {\n  Api.loginUser(data).then(function (res) {\n    if (res.success) {\n      Store.dispatch({\n        type: types.LOGIN_SUCCESS,\n        data: res\n      });\n      localStorage.setItem(AUTH_TOKEN_KEY, '324234324234');\n      redirectLogin();\n    } else {\n      Store.dispatch({\n        type: types.LOGIN_FAILURE,\n        data: res.error\n      });\n      clearSession();\n    }\n  }).catch(function (err) {\n    Store.dispatch({\n      type: types.LOGIN_FAILURE,\n      data: err.message\n    });\n    clearSession();\n  });\n}\n\nfunction removeOktaLoader() {\n  Store.dispatch({\n    type: types.OKTA_LOADING_DONE\n  });\n}\n\nfunction clearSession() {\n  removeOktaLoader();\n  window.widget.session.close(function (err) {\n    window.widget.remove();\n    localStorage.removeItem(AUTH_TOKEN_KEY);\n  });\n  history.push('/login-status');\n}\n\nexport function redirectLogin() {\n  removeOktaLoader();\n  var localToken = window.localStorage.getItem(AUTH_TOKEN_KEY);\n  var pathname = window.location.pathname;\n\n  if (localToken) {\n    if (pathname === '/' || pathname === '/login') {\n      history.push('/campaign');\n    }\n  } else {\n    var _pathname = window.location.pathname;\n\n    if (_pathname === '/login') {\n      return;\n    } else if (_pathname === '/') {\n      window.location.href = '/login';\n    } else {}\n  }\n}\nexport function singin() {\n  var widget = new window.OktaSignIn({\n    baseUrl: 'https://dev-943044.okta.com',\n    logo: 'https://ecs7.tokopedia.net/img/footer/toped.png',\n    clientId: '0oaj3yxtqHRcQbgta356',\n    redirectUri: window.location.origin + '/implicit/callback',\n    i18n: {\n      en: {\n        'primaryauth.title': 'Welcome To Campaign Manager, Sign in with your Okta Account'\n      }\n    },\n    authParams: {\n      responseType: ['id_token', 'token']\n    }\n  });\n  Store.dispatch({\n    type: types.OKTA_LOADING\n  });\n\n  var logOutUser = function logOutUser() {\n    localStorage.removeItem(AUTH_TOKEN_KEY);\n    history.push('/login');\n  };\n\n  widget.session.get(function (response) {\n    if (response.status === 'ACTIVE') {\n      loginAction({\n        email: response.login,\n        oktaToken: response.id\n      });\n    } else if (response.status === 'INACTIVE') {\n      removeOktaLoader();\n      logOutUser();\n    }\n  });\n  return widget;\n}","map":{"version":3,"sources":["/Users/chahanatyagi/Work/cm-frontend/src/actions/User.js"],"names":["history","types","Api","Store","AUTH_TOKEN_KEY","loginAction","data","loginUser","then","res","success","dispatch","type","LOGIN_SUCCESS","localStorage","setItem","redirectLogin","LOGIN_FAILURE","error","clearSession","catch","err","message","removeOktaLoader","OKTA_LOADING_DONE","window","widget","session","close","remove","removeItem","push","localToken","getItem","pathname","location","href","singin","OktaSignIn","baseUrl","logo","clientId","redirectUri","origin","i18n","en","authParams","responseType","OKTA_LOADING","logOutUser","get","response","status","email","login","oktaToken","id"],"mappings":"AAAA,OAAOA,OAAP,MAAoB,iBAApB;AACA,OAAO,KAAKC,KAAZ,MAAuB,mBAAvB,C,CACA;;AACA,OAAO,wDAAP;AACA,OAAO,kDAAP;AACA,OAAOC,GAAP,MAAgB,aAAhB;AACA,OAAOC,KAAP,MAAkB,WAAlB;AACA,OAAO,IAAMC,cAAc,GAAG,gBAAvB;AACP,OAAO,SAASC,WAAT,CAAqBC,IAArB,EAA2B;AAC9BJ,EAAAA,GAAG,CAACK,SAAJ,CAAcD,IAAd,EACKE,IADL,CACU,UAAAC,GAAG,EAAI;AACT,QAAIA,GAAG,CAACC,OAAR,EAAiB;AACbP,MAAAA,KAAK,CAACQ,QAAN,CAAe;AACXC,QAAAA,IAAI,EAAEX,KAAK,CAACY,aADD;AAEXP,QAAAA,IAAI,EAAEG;AAFK,OAAf;AAIAK,MAAAA,YAAY,CAACC,OAAb,CAAqBX,cAArB,EAAqC,cAArC;AACAY,MAAAA,aAAa;AAChB,KAPD,MAOO;AACHb,MAAAA,KAAK,CAACQ,QAAN,CAAe;AACXC,QAAAA,IAAI,EAAEX,KAAK,CAACgB,aADD;AAEXX,QAAAA,IAAI,EAAEG,GAAG,CAACS;AAFC,OAAf;AAIAC,MAAAA,YAAY;AACf;AACJ,GAhBL,EAiBKC,KAjBL,CAiBW,UAAAC,GAAG,EAAI;AACVlB,IAAAA,KAAK,CAACQ,QAAN,CAAe;AACXC,MAAAA,IAAI,EAAEX,KAAK,CAACgB,aADD;AAEXX,MAAAA,IAAI,EAAEe,GAAG,CAACC;AAFC,KAAf;AAIAH,IAAAA,YAAY;AACf,GAvBL;AAwBH;;AACD,SAASI,gBAAT,GAA4B;AACxBpB,EAAAA,KAAK,CAACQ,QAAN,CAAe;AACXC,IAAAA,IAAI,EAAEX,KAAK,CAACuB;AADD,GAAf;AAGH;;AACD,SAASL,YAAT,GAAwB;AACpBI,EAAAA,gBAAgB;AAChBE,EAAAA,MAAM,CAACC,MAAP,CAAcC,OAAd,CAAsBC,KAAtB,CAA4B,UAASP,GAAT,EAAc;AACtCI,IAAAA,MAAM,CAACC,MAAP,CAAcG,MAAd;AACAf,IAAAA,YAAY,CAACgB,UAAb,CAAwB1B,cAAxB;AACH,GAHD;AAIAJ,EAAAA,OAAO,CAAC+B,IAAR,CAAa,eAAb;AACH;;AAED,OAAO,SAASf,aAAT,GAAyB;AAC5BO,EAAAA,gBAAgB;AAChB,MAAMS,UAAU,GAAGP,MAAM,CAACX,YAAP,CAAoBmB,OAApB,CAA4B7B,cAA5B,CAAnB;AAF4B,MAGpB8B,QAHoB,GAGPT,MAAM,CAACU,QAHA,CAGpBD,QAHoB;;AAI5B,MAAIF,UAAJ,EAAgB;AACZ,QAAIE,QAAQ,KAAK,GAAb,IAAoBA,QAAQ,KAAK,QAArC,EAA+C;AAC3ClC,MAAAA,OAAO,CAAC+B,IAAR,CAAa,WAAb;AACH;AACJ,GAJD,MAIO;AAAA,QACKG,SADL,GACkBT,MAAM,CAACU,QADzB,CACKD,QADL;;AAEH,QAAIA,SAAQ,KAAK,QAAjB,EAA2B;AACvB;AACH,KAFD,MAEO,IAAIA,SAAQ,KAAK,GAAjB,EAAsB;AACzBT,MAAAA,MAAM,CAACU,QAAP,CAAgBC,IAAhB,GAAuB,QAAvB;AACH,KAFM,MAEA,CACN;AACJ;AACJ;AAED,OAAO,SAASC,MAAT,GAAkB;AACrB,MAAIX,MAAM,GAAG,IAAID,MAAM,CAACa,UAAX,CAAsB;AAC/BC,IAAAA,OAAO,EAAE,6BADsB;AAE/BC,IAAAA,IAAI,EAAE,iDAFyB;AAG/BC,IAAAA,QAAQ,EAAE,sBAHqB;AAI/BC,IAAAA,WAAW,EAAEjB,MAAM,CAACU,QAAP,CAAgBQ,MAAhB,GAAyB,oBAJP;AAK/BC,IAAAA,IAAI,EAAE;AACFC,MAAAA,EAAE,EAAE;AACA,6BAAqB;AADrB;AADF,KALyB;AAU/BC,IAAAA,UAAU,EAAE;AACRC,MAAAA,YAAY,EAAE,CAAC,UAAD,EAAa,OAAb;AADN;AAVmB,GAAtB,CAAb;AAcA5C,EAAAA,KAAK,CAACQ,QAAN,CAAe;AACXC,IAAAA,IAAI,EAAEX,KAAK,CAAC+C;AADD,GAAf;;AAGA,MAAIC,UAAU,GAAG,SAAbA,UAAa,GAAM;AACnBnC,IAAAA,YAAY,CAACgB,UAAb,CAAwB1B,cAAxB;AACAJ,IAAAA,OAAO,CAAC+B,IAAR,CAAa,QAAb;AACH,GAHD;;AAKAL,EAAAA,MAAM,CAACC,OAAP,CAAeuB,GAAf,CAAmB,UAAAC,QAAQ,EAAI;AAC3B,QAAIA,QAAQ,CAACC,MAAT,KAAoB,QAAxB,EAAkC;AAC9B/C,MAAAA,WAAW,CAAC;AAAEgD,QAAAA,KAAK,EAAEF,QAAQ,CAACG,KAAlB;AAAyBC,QAAAA,SAAS,EAAEJ,QAAQ,CAACK;AAA7C,OAAD,CAAX;AACH,KAFD,MAEO,IAAIL,QAAQ,CAACC,MAAT,KAAoB,UAAxB,EAAoC;AACvC7B,MAAAA,gBAAgB;AAChB0B,MAAAA,UAAU;AACb;AACJ,GAPD;AAQA,SAAOvB,MAAP;AACH","sourcesContent":["import history from '@/utils/history'\nimport * as types from '@/constants/Types'\n// import OktaSignIn from '@okta/okta-signin-widget'\nimport '@okta/okta-signin-widget/dist/css/okta-sign-in.min.css'\nimport '@okta/okta-signin-widget/dist/css/okta-theme.css'\nimport Api from '@/utils/Api'\nimport Store from '@/reducer'\nexport const AUTH_TOKEN_KEY = 'AUTH_TOKEN_KEY'\nexport function loginAction(data) {\n    Api.loginUser(data)\n        .then(res => {\n            if (res.success) {\n                Store.dispatch({\n                    type: types.LOGIN_SUCCESS,\n                    data: res,\n                })\n                localStorage.setItem(AUTH_TOKEN_KEY, '324234324234')\n                redirectLogin()\n            } else {\n                Store.dispatch({\n                    type: types.LOGIN_FAILURE,\n                    data: res.error,\n                })\n                clearSession()\n            }\n        })\n        .catch(err => {\n            Store.dispatch({\n                type: types.LOGIN_FAILURE,\n                data: err.message,\n            })\n            clearSession()\n        })\n}\nfunction removeOktaLoader() {\n    Store.dispatch({\n        type: types.OKTA_LOADING_DONE,\n    })\n}\nfunction clearSession() {\n    removeOktaLoader()\n    window.widget.session.close(function(err) {\n        window.widget.remove()\n        localStorage.removeItem(AUTH_TOKEN_KEY)\n    })\n    history.push('/login-status')\n}\n\nexport function redirectLogin() {\n    removeOktaLoader()\n    const localToken = window.localStorage.getItem(AUTH_TOKEN_KEY)\n    const { pathname } = window.location\n    if (localToken) {\n        if (pathname === '/' || pathname === '/login') {\n            history.push('/campaign')\n        }\n    } else {\n        const { pathname } = window.location\n        if (pathname === '/login') {\n            return\n        } else if (pathname === '/') {\n            window.location.href = '/login'\n        } else {\n        }\n    }\n}\n\nexport function singin() {\n    var widget = new window.OktaSignIn({\n        baseUrl: 'https://dev-943044.okta.com',\n        logo: 'https://ecs7.tokopedia.net/img/footer/toped.png',\n        clientId: '0oaj3yxtqHRcQbgta356',\n        redirectUri: window.location.origin + '/implicit/callback',\n        i18n: {\n            en: {\n                'primaryauth.title': 'Welcome To Campaign Manager, Sign in with your Okta Account',\n            },\n        },\n        authParams: {\n            responseType: ['id_token', 'token'],\n        },\n    })\n    Store.dispatch({\n        type: types.OKTA_LOADING,\n    })\n    var logOutUser = () => {\n        localStorage.removeItem(AUTH_TOKEN_KEY)\n        history.push('/login')\n    }\n\n    widget.session.get(response => {\n        if (response.status === 'ACTIVE') {\n            loginAction({ email: response.login, oktaToken: response.id })\n        } else if (response.status === 'INACTIVE') {\n            removeOktaLoader()\n            logOutUser()\n        }\n    })\n    return widget\n}\n"]},"metadata":{},"sourceType":"module"}